#!/bin/sh

# Pre-commit hook for automated frontend testing
# Runs when frontend files are staged for commit

echo "🚀 Running pre-commit frontend tests..."

# Check if any frontend files are staged
FRONTEND_FILES=$(git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx|css|html)$' | grep -E '^(src/|public/|index\.html|vite\.config\.ts|tailwind\.config\.js|postcss\.config\.js|tsconfig.*\.json)$')

if [ -z "$FRONTEND_FILES" ]; then
  echo "✅ No frontend files changed, skipping frontend tests"
  exit 0
fi

echo "🔍 Frontend files changed:"
echo "$FRONTEND_FILES"

# Run frontend tests
echo "🧪 Running frontend tests..."
npm run test:frontend-changes

if [ $? -ne 0 ]; then
  echo "❌ Frontend tests failed. Please fix the issues before committing."
  echo "💡 You can run 'npm run test:frontend' to see detailed results."
  exit 1
fi

echo "✅ Frontend tests passed!"
exit 0