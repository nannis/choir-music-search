#!/bin/sh

# Pre-commit hook for automated frontend testing
# Runs when frontend files are staged for commit

echo "ğŸš€ Running pre-commit frontend tests..."

# Check if any frontend files are staged
FRONTEND_FILES=$(git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx|css|html)$' | grep -E '^(src/|public/|index\.html|vite\.config\.ts|tailwind\.config\.js|postcss\.config\.js|tsconfig.*\.json)$')

if [ -z "$FRONTEND_FILES" ]; then
  echo "âœ… No frontend files changed, skipping frontend tests"
  exit 0
fi

echo "ğŸ” Frontend files changed:"
echo "$FRONTEND_FILES"

# Run frontend tests
echo "ğŸ§ª Running frontend tests..."
npm run test:frontend-changes

if [ $? -ne 0 ]; then
  echo "âŒ Frontend tests failed. Please fix the issues before committing."
  echo "ğŸ’¡ You can run 'npm run test:frontend' to see detailed results."
  exit 1
fi

echo "âœ… Frontend tests passed!"
exit 0